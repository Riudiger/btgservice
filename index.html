<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Atendimento Telef√¥nico</title>

<script src="https://api.backendless.com/sdk/js/latest/backendless.min.js"></script>
<script>
Backendless.initApp(
  "16519BB0-2CC5-4D6D-A7C8-CC9B9D69F91B",
  "FD19561E-7DE2-4E6B-AA75-2C846AF62F87"
);
</script>

<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#f4f6f8;color:#0f172a}
header{background:#001e36;color:#fff;padding:15px;text-align:center;font-size:20px;font-weight:bold;position:relative}
.admin-btn{position:absolute;right:20px;top:12px;background:#0b3c5d;color:#fff;border:none;padding:8px 14px;border-radius:8px;cursor:pointer}
.admin-panel{position:fixed;top:60px;right:20px;width:360px;background:#fff;padding:20px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.15);display:none;z-index:999}
.container{max-width:1300px;margin:20px auto;padding:20px}
.card{background:#fff;padding:20px;border-radius:14px;margin-bottom:20px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
.pause-buttons{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #e5e7eb;padding:8px;text-align:center}
th{background:#eef2f6}
.status{display:flex;align-items:center;justify-content:center;gap:6px;font-weight:bold}
.bolinha{width:10px;height:10px;border-radius:50%}
.verde{background:#16a34a}
.vermelho{background:#dc2626}
</style>
</head>

<body>

<header>
üìû Painel de Atendimento
<button class="admin-btn" onclick="toggleAdmin()">üõ†Ô∏è Admin</button>
</header>

<div class="admin-panel" id="adminPanel">
<h2>Cadastro Analista</h2>
<input id="analistaNome" placeholder="Nome"><br><br>
<select id="analistaCanal">
<option value="">Canal</option>
<option value="Telefone">Telefone</option>
<option value="Chat">Chat</option>
</select><br><br>
<button onclick="cadastrarAnalista()">Salvar</button>
<button onclick="toggleAdmin()">Fechar</button>
</div>

<div class="container">

<div class="card">
<h2>Controle de Pausas</h2>
<select id="selectAnalista"></select><br><br>
<div class="pause-buttons">
<button onclick="iniciarPausa('Almo√ßo')">Almo√ßo</button>
<button onclick="iniciarPausa('Reuni√£o')">Reuni√£o</button>
<button onclick="iniciarPausa('Lanche')">Lanche</button>
<button onclick="iniciarPausa('Banheiro')">Banheiro</button>
</div>
<button onclick="finalizarPausa()" style="margin-top:15px;background:#b91c1c;color:#fff">Finalizar</button>
</div>

<div class="card">
<h2>Painel Administrativo</h2>
<table>
<thead>
<tr><th>Analista</th><th>Canal</th><th>Pausa</th><th>Tempo</th><th>Total</th><th>Status</th></tr>
</thead>
<tbody id="adminTabela"></tbody>
</table>
</div>

</div>

<script>
function dataHoje(){
  const d=new Date();
  return d.toISOString().slice(0,10);
}

const analistas={}, pausasAtivas={}, totalTempoAnalista={}
let estadoId=null

function toggleAdmin(){
  adminPanel.style.display=adminPanel.style.display==="block"?"none":"block"
}

function cadastrarAnalista(){
  if(!analistaNome.value||!analistaCanal.value) return
  analistas[analistaNome.value]=analistaCanal.value
  atualizarTudo()
  salvarEstado()
}

function iniciarPausa(tipo){
  const nome=selectAnalista.value
  if(!nome||pausasAtivas[nome]) return
  pausasAtivas[nome]={tipo,inicio:Date.now()}
  salvarEstado()
}

function finalizarPausa(){
  const nome=selectAnalista.value
  if(!pausasAtivas[nome]) return
  const d=Math.floor((Date.now()-pausasAtivas[nome].inicio)/1000)
  totalTempoAnalista[nome]=(totalTempoAnalista[nome]||0)+d
  delete pausasAtivas[nome]
  salvarEstado()
}

function atualizarTudo(){
  selectAnalista.innerHTML=`<option value="">Selecione</option>`
  adminTabela.innerHTML=""
  Object.keys(analistas).forEach(n=>{
    selectAnalista.innerHTML+=`<option>${n}</option>`
    const p=pausasAtivas[n]
    adminTabela.innerHTML+=`
      <tr>
        <td>${n}</td>
        <td>${analistas[n]}</td>
        <td>${p?p.tipo:"-"}</td>
        <td>${p?formatar(p.inicio):"-"}</td>
        <td>${formatarSeg(totalTempoAnalista[n]||0)}</td>
        <td class="status"><span class="bolinha ${p?"vermelho":"verde"}"></span>${p?"Pausa":"Livre"}</td>
      </tr>`
  })
}

function formatar(i){return formatarSeg(Math.floor((Date.now()-i)/1000))}
function formatarSeg(s){return `${String(Math.floor(s/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`}

function salvarEstado(){
  const data={estado:JSON.stringify({analistas,pausasAtivas,totalTempoAnalista}),data:dataHoje()}
  if(estadoId) data.objectId=estadoId
  Backendless.Data.of("PainelEstado").save(data).then(r=>estadoId=r.objectId)
}

function carregarEstado(){
  Backendless.Data.of("PainelEstado")
  .find({where:`data='${dataHoje()}'`})
  .then(r=>{
    if(!r.length) return
    estadoId=r[0].objectId
    const d=JSON.parse(r[0].estado)
    Object.assign(analistas,d.analistas||{})
    Object.assign(pausasAtivas,d.pausasAtivas||{})
    Object.assign(totalTempoAnalista,d.totalTempoAnalista||{})
    atualizarTudo()
  })
}

setInterval(carregarEstado,2000)
setInterval(atualizarTudo,1000)
carregarEstado()
</script>

</body>
</html>
